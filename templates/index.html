{% extends 'layout.html' %}

{% block title %}Contacts & Calendar Downloader{% endblock %}

{% block content %}
    <div class="header">
        <div class="logo"><img src="{{ url_for('static', filename='favicon.png') }}" alt="Logo" width="96" height="96"></div>
        <h1>Contacts & Calendar Downloader</h1>
        <p class="subtitle">Secure, multi-tenant service for downloading contacts and calendar data from Google and Microsoft with read-only access</p>
    </div>


    <div class="quick-start">
        <h3>Quick Start Guide</h3>
        
        <div class="step">
            <strong>Start Authorization</strong><br>
            Click "Get Started" below to begin the OAuth flow and get your authorization URL
        </div>
        
        <div class="step">
            <strong>Authorize with Google or Microsoft</strong><br>
            Visit the authorization URL in your browser and grant read-only access to your contacts
        </div>
        
        <div class="step">
            <strong>Get Your Export URLs</strong><br>
            After authorization, you'll receive multiple export URLs for contacts and calendar data.
            You are also provided with a Bearer token to authenticate API requests.
        </div>
        
        <div class="step">
            <strong>Download Contacts</strong><br>
            Use the provided URLs or integrate the API into your application to download your contacts
        </div>
    </div>

    <h2>Get Started</h2>

    <div class="actions" style="display:flex; gap:12px; flex-wrap:wrap;">
        <a href="/auth?provider=google" class="btn">Authorize with Google</a>
        <a href="/auth?provider=microsoft" class="btn">Authorize with Microsoft</a>
    </div>

    <div class="security-notice">
        <span class="security-icon">üîí</span>
        <strong>Read-Only Access:</strong> This service only requests read-only access to your Google and Microsoft accounts. 
        The service cannot modify, delete, or add any data to your account.
    </div>

    <h2>Features</h2>

    <div class="feature-grid">
        <div class="feature-card">
            <div class="feature-title">
                <span class="feature-icon">üåê</span>Multi-Provider Support
            </div>
            <p>Authenticate with Google or Microsoft to download contacts and calendar data from either provider.</p>
        </div>

        <div class="feature-card">
            <div class="feature-title">
                <span class="feature-icon">üîê</span>Secure Database Storage
            </div>
            <p>SQLite database with AES encryption stores tokens securely. No contact data is ever saved on our servers.</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-title">
                <span class="feature-icon">üîë</span>Bearer Token Authentication
            </div>
            <p>JWT-like access tokens provide secure API access with automatic token refresh and easy revocation.</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-title">
                <span class="feature-icon">üìä</span>Multiple Export Formats
            </div>
            <p>Download your contacts in CSV or JSON format and calendar events in ICS format. Perfect for data analysis, backup, or migration purposes.</p>
        </div>
    </div>

    <h3>Available Endpoints</h3>
    <ul class="endpoints-list compact">
        <li>
            <code>/auth?provider=google|microsoft</code> ‚Äî Start OAuth and get the authorization URL (use provider param).
            <br><small>Callback: <code>/auth/callback?provider=...</code> ‚Äî issues encrypted tokens and export URLs.</small>
        </li>

        <li>
            <code>/download/contacts?format=csv|json&export_id=...</code> ‚Äî Download contacts in CSV or JSON.
            <br><small><strong>Requires:</strong> Authorization: Bearer &mdash; read-only contacts scope.</small>
        </li>

        <li>
            <code>/download/calendar?format=ics&export_id=...</code> ‚Äî Download calendar events in ICS.
            <br><small><strong>Requires:</strong> Authorization: Bearer &mdash; calendar scope.</small>
        </li>

        <li>
            <code>/manage/tokens</code> ‚Äî List and revoke Bearer tokens for your exports.
            <br><small><strong>Requires:</strong> Authorization: Bearer.</small>
        </li>

        <li>
            <code>/metrics</code> ‚Äî Prometheus metrics for monitoring (read-only).
        </li>
    </ul>
{% endblock %}