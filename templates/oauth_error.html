{% extends 'layout.html' %}

{% block title %}Authorization Error{% endblock %}

{% block content %}
  <div class="text-center mb-8">
    <div class="text-6xl text-red-500 mb-4">‚ùå</div>
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Authorization Failed</h1>
    <p class="text-gray-600">There was a problem connecting your account.</p>
  </div>

  <div class="bg-red-50 border-l-4 border-red-500 p-5 rounded-lg mb-6">
    <h3 class="text-lg font-semibold text-gray-800 mb-2">Error Details</h3>
    <p class="text-gray-800 font-semibold">{{ error_message or error }}</p>
    {% if error_details %}
      <div class="bg-gray-100 p-4 rounded mt-3 font-mono text-sm break-all">{{ error_details }}</div>
    {% endif %}
  </div>

  {% if troubleshooting %}
    <div class="bg-primary-50 border-l-4 border-primary-600 p-5 rounded-lg mb-6">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">How to Fix This</h3>
      {% if troubleshooting.error_type == 'redirect_uri_mismatch' %}
        <p class="text-gray-700 mb-4">The redirect URI in your request doesn't match what's configured in Google Cloud Console.</p>
        <div class="space-y-3">
          <div class="flex gap-3">
            <div class="flex-shrink-0 w-6 h-6 bg-primary-600 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
            <div class="text-gray-700">
              Go to <a href="{{ troubleshooting.google_cloud_console }}" target="_blank" class="text-primary-600 hover:underline">Google Cloud Console</a>
            </div>
          </div>
          <div class="flex gap-3">
            <div class="flex-shrink-0 w-6 h-6 bg-primary-600 text-white rounded-full flex items-center justify-center text-sm font-bold">2</div>
            <div class="text-gray-700">
              Add this URI to "Authorized redirect URIs":<br>
              <code class="bg-gray-200 px-2 py-1 rounded text-sm mt-2 inline-block break-all">{{ troubleshooting.check_uri }}</code>
            </div>
          </div>
        </div>
      {% else %}
        <p class="text-gray-700 mb-2"><strong>Solution:</strong> {{ troubleshooting.solution }}</p>
        {% if troubleshooting.details %}
          <div class="bg-gray-100 p-4 rounded mt-3 font-mono text-sm break-all">{{ troubleshooting.details }}</div>
        {% endif %}
      {% endif %}
    </div>
  {% endif %}

  <div class="text-center">
    <a href="/auth" class="inline-flex items-center justify-center px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors">Try Again</a>
  </div>
{% endblock %}