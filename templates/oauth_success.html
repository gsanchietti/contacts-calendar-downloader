{% extends 'layout.html' %}

{% block title %}Authorization Successful - Google Contacts Downloader{% endblock %}

{% block content %}
    <div class="text-center mb-8">
        <div class="text-6xl text-green-500 mb-4">‚úÖ</div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Authorization Successful!</h1>
        <p class="text-gray-600">Your account has been successfully connected to the Contacts & Calendar Downloader.</p>
    </div>

    <div class="bg-primary-50 border-l-4 border-primary-600 p-4 rounded-lg mb-6">
        <strong class="text-gray-800">Authorized Account:</strong> <span class="text-gray-700">{{ user_email }}</span>
        <div class="mt-2 text-gray-600 text-sm">Provider: {{ provider|default('google') }}</div>
    </div>

    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg mb-6">
        <span class="text-2xl mr-2">‚ö†Ô∏è</span>
        <strong class="text-gray-800">Important:</strong>
        <span class="text-gray-700">Keep your access token secure and don't share it with others. It provides access to your Contacts and Calendars.</span>
    </div>

    <div class="bg-purple-50 border-l-4 border-purple-500 p-5 rounded-lg mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">üîó Permanent Export URLs</h3>
        <p class="text-gray-700 mb-4">These URLs work forever without authentication - keep them secret!</p>

        <div class="mb-4">
            <strong class="text-gray-800 block mb-2">üìÑ Contacts CSV:</strong>
            <div class="flex gap-2">
                <input type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary-500 focus:border-primary-500" id="contactsUrl" value="{{ base_url }}/export/contacts/{{ export_token }}.csv" readonly>
                <button class="px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors" onclick="copyUrl('contactsUrl')">Copy</button>
            </div>
        </div>

        <div class="mb-4">
            <strong class="text-gray-800 block mb-2">üìÖ Calendar ICS:</strong>
            <div class="flex gap-2">
                <input type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary-500 focus:border-primary-500" id="calendarUrl" value="{{ base_url }}/export/calendar/{{ export_token }}.ics" readonly>
                <button class="px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors" onclick="copyUrl('calendarUrl')">Copy</button>
            </div>
        </div>

        <div class="mb-4">
            <strong class="text-gray-800 block mb-2">‚öôÔ∏è Data Management:</strong>
            <div class="flex gap-2">
                <input type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-primary-500 focus:border-primary-500" id="manageUrl" value="{{ base_url }}/manage/{{ export_token }}" readonly>
                <button class="px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors" onclick="copyUrl('manageUrl')">Copy</button>
            </div>
        </div>
    </div>

    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-5 rounded-lg mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Your Access Token</h3>
        <p class="text-gray-700 mb-3">Copy this token to use with the API. You'll need it for all download requests:</p>
        <div class="flex gap-2">
            <input type="text" class="flex-1 px-3 py-2 border border-gray-300 rounded font-mono text-sm break-all focus:ring-2 focus:ring-primary-500 focus:border-primary-500" id="accessToken" value="{{ access_token }}" readonly>
            <button class="px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700 transition-colors" onclick="copyToken()">Copy</button>
        </div>
    </div>

    <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">How to Use Your Token</h3>
        <p class="text-gray-700 mb-3">Use your access token in the <code class="bg-gray-200 px-2 py-1 rounded">Authorization</code> header for API requests:</p>
        
        <div class="bg-gray-100 p-3 rounded-lg mb-3 overflow-x-auto">
            <code class="text-sm text-gray-800 break-all">curl -H "Authorization: Bearer {{ access_token }}" \<br>"{{base_url}}/download/contacts?format=json" &gt; contacts.json</code>
        </div>
        
        <div class="bg-gray-100 p-3 rounded-lg mb-3 overflow-x-auto">
            <code class="text-sm text-gray-800 break-all">curl -H "Authorization: Bearer {{ access_token }}" \<br>"{{base_url}}/download/contacts?format=csv" &gt; contacts.csv</code>
        </div>
        
        <div class="bg-gray-100 p-3 rounded-lg overflow-x-auto">
            <code class="text-sm text-gray-800 break-all">curl -H "Authorization: Bearer {{ access_token }}" \<br>"{{base_url}}/download/calendar" &gt; calendar.ics</code>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    function copyToken() {
        const tokenInput = document.getElementById('accessToken');
        const copyBtn = event.target;
        tokenInput.select();
        tokenInput.setSelectionRange(0, 99999);
        try {
            document.execCommand('copy');
            copyBtn.textContent = 'Copied!';
            setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
        } catch(e) {
            copyBtn.textContent = 'Failed';
            setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
        }
    }
    
    function copyUrl(inputId) {
        const urlInput = document.getElementById(inputId);
        const copyBtn = event.target;
        urlInput.select();
        urlInput.setSelectionRange(0, 99999);
        try {
            document.execCommand('copy');
            copyBtn.textContent = 'Copied!';
            setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
        } catch(e) {
            copyBtn.textContent = 'Failed';
            setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
        }
    }
    
    document.getElementById('accessToken')?.addEventListener('click', function() {
        this.select();
    });
</script>
{% endblock %}
