{% extends 'layout.html' %}

{% block title %}Authorization Successful - Google Contacts Downloader{% endblock %}

{% block head %}
<style>
    .success-header { text-align: center; margin-bottom: 30px; }
    .success-icon { color: #34a853; font-size: 4em; margin-bottom: 10px; }
    .user-info { background-color: #e8f0fe; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #1a73e8; }
    .token-section { background-color: #fef7e0; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #f9ab00; }
    .token-input { width: calc(100% - 90px); padding: 8px; }
    .copy-btn { padding: 8px 12px; margin-left: 8px; }
    .code-example { background:#f1f3f4;padding:12px;border-radius:6px;margin:10px 0;font-family:monospace;white-space:pre-wrap; }
    .highlight { background:#fff3cd; padding:2px 6px; border-radius:4px; }
    .warning { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0; }
    .warning-icon { color: #f57c00; margin-right: 8px; }
</style>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="success-header">
            <div class="success-icon">‚úÖ</div>
            <h1>Authorization Successful!</h1>
            <p>Your account has been successfully connected to the Contacts & Calendar Downloader.</p>
        </div>

        <div class="user-info">
            <strong>Authorized Account:</strong> {{ user_email }}
            <div style="margin-top:8px;color:#666;font-size:0.9em;">Provider: {{ provider|default('google') }}</div>
        </div>

        <div class="warning">
            <span class="warning-icon">‚ö†Ô∏è</span>
            <strong>Important:</strong> Keep your access token secure and don't share it with others. It provides access to your Contacts and Calendars.
        </div>

        <div class="token-section" style="background-color: #f3e5f5; border-left-color: #9c27b0;">
            <h3>üîó Permanent Export URLs</h3>
            <p>These URLs work forever without authentication - keep them secret!</p>

            <div style="margin: 15px 0;">
                <strong>üìÑ Contacts CSV:</strong><br>
                <div class="token-container">
                    <input type="text" class="token-input" id="contactsUrl" value="{{ base_url }}/export/contacts/{{ export_token }}.csv" readonly>
                    <button class="copy-btn" onclick="copyUrl('contactsUrl')">Copy</button>
                </div>
            </div>

            <div style="margin: 15px 0;">
                <strong>üìÖ Calendar ICS:</strong><br>
                <div class="token-container">
                    <input type="text" class="token-input" id="calendarUrl" value="{{ base_url }}/export/calendar/{{ export_token }}.ics" readonly>
                    <button class="copy-btn" onclick="copyUrl('calendarUrl')">Copy</button>
                </div>
            </div>

            <div style="margin: 15px 0;">
                <strong>‚öôÔ∏è Data Management:</strong><br>
                <div class="token-container">
                    <input type="text" class="token-input" id="manageUrl" value="{{ base_url }}/manage/{{ export_token }}" readonly>
                    <button class="copy-btn" onclick="copyUrl('manageUrl')">Copy</button>
                </div>
            </div>
        </div>

        <div class="token-section">
            <h3>Your Access Token</h3>
            <p>Copy this token to use with the API. You'll need it for all download requests:</p>
            <div class="token-container">
                <input type="text" class="token-input" id="accessToken" value="{{ access_token }}" readonly>
                <button class="copy-btn" onclick="copyToken()">Copy</button>
            </div>
        </div>

        <div class="instructions">
            <h3>How to Use Your Token</h3>
            <p>Use your access token in the <code>Authorization</code> header for API requests:</p>
            <div class="code-example">curl -H "Authorization: Bearer {{ access_token }}" \
"{{base_url}}/download/contacts?format=json" &gt; contacts.json</div>
            <div class="code-example">curl -H "Authorization: Bearer {{ access_token }}" \
"{{base_url}}/download/contacts?format=csv" &gt; contacts.csv</div>
            <div class="code-example">curl -H "Authorization: Bearer {{ access_token }}" \
"{{base_url}}/download/calendar" &gt; calendar.ics</div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    function copyToken() {
        const tokenInput = document.getElementById('accessToken');
        const copyBtn = document.querySelector('.copy-btn');
        tokenInput.select(); tokenInput.setSelectionRange(0,99999);
        try { document.execCommand('copy'); copyBtn.textContent='Copied!'; setTimeout(()=>{copyBtn.textContent='Copy';},2000);} catch(e){copyBtn.textContent='Failed';setTimeout(()=>{copyBtn.textContent='Copy';},2000);}    
    }
    function copyUrl(inputId){ const urlInput=document.getElementById(inputId); const copyBtn=urlInput.parentNode.querySelector('.copy-btn'); urlInput.select(); urlInput.setSelectionRange(0,99999); try{ document.execCommand('copy'); copyBtn.textContent='Copied!'; setTimeout(()=>{copyBtn.textContent='Copy';},2000);}catch(e){copyBtn.textContent='Failed';setTimeout(()=>{copyBtn.textContent='Copy';},2000);} }
    document.getElementById('accessToken')?.addEventListener('click', function(){ this.select(); });
</script>
{% endblock %}
